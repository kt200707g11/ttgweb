function tracking(a){a.im=im,a._csrf=yii.getCsrfToken(),$.ajax({method:"POST",url:"/listing/tracking",data:a})}function toogleScroll(){var a=$("#search-form").outerHeight(),b=$(".wrap-listing-item .inner-wrap").outerHeight();$(".wrap-listing").css("height",b-a+"px")}function getShowNumFrm(a){if(!a)return void $(".show-num-frm").each(function(){var a=$(this),b=0;a.find(".val-selected .selected").find("span").remove(),a.find(":input").not("input[type=hidden]").each(function(){""!=$(this).val()&&(b+=1)}),b>0&&a.find(".val-selected .selected").append('<span style="display: inline-block;padding-left:5px;">('+b+")</span>")});if(el=$(this),el.closest(".show-num-frm").length>0){var b=0;el.closest(".show-num-frm").find(":input").not("input[type=hidden]").each(function(){""!=$(this).val()&&(b+=1,el.closest(".show-num-frm").find(".val-selected .selected").find("span").remove(),el.closest(".show-num-frm").find(".val-selected .selected").append('<span style="display: inline-block;padding-left:5px;">('+b+")</span>")),0==b&&el.closest(".show-num-frm").find(".val-selected .selected").find("span").remove()})}}var desktop,form,events,$window=$(window),s={type:"#type"},im=window.navigator.userAgent.search("Mobi")!==-1?1:0;$(document).ready(function(){events={mobileEvents:[],desktopEvents:[],attachMobileEvent:function(){events._attachEvent.apply(events.mobileEvents,arguments)},attachDesktopEvent:function(){events._attachEvent.apply(events.desktopEvents,arguments)},_attachEvent:function(){events.switchEvent("on",arguments),this.push(arguments)},detachMobileEvents:function(){events._detachEvents(events.mobileEvents),events._attachEvents(events.desktopEvents)},detachDesktopEvents:function(){events._detachEvents(events.desktopEvents),events._attachEvents(events.mobileEvents)},_detachEvents:function(a){for(var b in a)events.switchEvent("off",a[b])},_attachEvents:function(a){for(var b in a)events.switchEvent("on",a[b])},switchEvent:function(a,b){var c=[];for(var d in b)c.push(b[d]);var e=c.splice(0,1);e=e[0],e[a].apply(e,c)}},form={el:$("#search-form"),listSearchEl:$("#search-list"),mapSearchEl:$("#map-search"),autoFill:$("#map-search-wrap").find(".auto-fill"),fields:null,filterFields:function(a){a.preventDefault(),form.fields.filter(function(){return!this.value}).prop("disabled",!0),window.location=form.mappingUrl(form.el.serialize())+"?tf="+tf_ip},mappingUrl:function(a){for(var a=decodeURIComponent(a),b=a.split("&"),c=[],d=[],f=0;f<b.length;f++){var g=b[f].split("="),h=g[0],i=g[1],j="_min",k="_max";if(h.lastIndexOf(j)==h.length-j.length)d.push(h.replace(j,"")+"="+i);else if(h.lastIndexOf(k)==h.length-k.length){var l=d.length-1,m=d[l].split("="),n=h.replace(k,"");m[0]==n?d[l]=d[l]+"-"+i:d.push(n+"=-"+i)}else d.push(b[f])}for(var f=0;f<d.length;f++)if(g=d[f].split("="),"category_id"==g[0])c.push(catsSlug[g[1]]);else if(fieldsMapping[g[0]]){var i="order_by"==g[0]?sortMapping[g[1]]:g[1];c.push(fieldsMapping[g[0]]+"_"+i)}return actionId+"/"+c.join("/")},sortSubmit:function(){form.el.submit()},searchFocus:function(a){form.mapSearchEl.val(""),form.showSearchList(),form.listSearchEl.find(".hint-wrap").show();var b=getCookie("sh1");if(b){form.listSearchEl.find(".center").show();var c=JSON.parse(b),d=c.length;form.listSearchUl.html("");for(var e=0;e<d;e++)form.listSearchUl.append('<li><a class="search-item" href="javascript:;" data-slug="'+c[e].s+'" data-id="'+c[e].i+'" data-type="'+c[e].t+'">'+decodeURIComponent(c[e].v)+"</a></li>")}else form.listSearchEl.find(".center").hide()},searchTyping:function(a){if(13==a.keyCode){var b=form.listSearchUl.find(".active");if(b)return form.mapSearchEl.blur(),void b.find("a").trigger("click")}if(38==a.keyCode||40==a.keyCode){var c=form.listSearchUl.data("text");"string"!=typeof c&&form.listSearchUl.data("text",form.mapSearchEl.val());var d=form.listSearchUl.children(),e=40==a.keyCode?1:-1,b=form.listSearchUl.find(".active"),f=d.index(b),g=f+e,h=d.length;if(g==h?g=-1:g==-2&&(g=h-1),g==-1)"string"==typeof c&&form.mapSearchEl.val(c);else{var i=d.eq(g).addClass("active");form.mapSearchEl.val(i.text())}return void b.removeClass("active")}form.listSearchUl.data("text",!1);var j=form.mapSearchEl.val().trim(),k=form.fields.filter(s.type).val();""!=j?($.data(this,"ajax")&&$.data(this,"ajax").abort(),$.data(this,"ajax",$.get("/api/v1/map/get",{v:j,t:k},function(a){if(form.listSearchUl.html(""),a.length){for(var b=0;b<a.length;b++){var c=a[b];form.listSearchUl.append('<li><a class="search-item" href="javascript:;" data-slug="'+c.slug+'" data-id="'+c.id+'" data-type="'+c.type+'">'+c.full_name+"</a></li>")}form.showSearchList(),form.listSearchEl.find(".hint-wrap").hide()}}))):(form.listSearchUl.html(""),form.searchFocus())},searchItemMouseEnter:function(){var a=form.listSearchUl.find(".active");a.removeClass("active"),$(this).parent().addClass("active")},searchItemMouseLeave:function(){$(this).parent().removeClass("active")},searchItemClick:function(){var a=$(this),b=a.text(),c=a.data("type"),d=a.data("id"),e=a.data("slug");form.mapSearchEl.data("val",b).val(b),form.autoFill.val("").filter("#"+c+"_id").val(d),$segments=actionId.split("/"),actionId="/"+$segments[1]+"/"+e;for(var f=getCookie("sh1"),g=f?JSON.parse(f):[],h=!1,i=0;i<g.length;i++){var j=g[i];if(j.i==d&&j.t==c){h=!0;break}}h?move(g,i,0):(g.length>4&&g.pop(),g.unshift({v:encodeURIComponent(b),i:d,t:c,s:e})),setCookie("sh1",JSON.stringify(g))},showSearchList:function(){form.listSearchEl.hasClass("hide")&&(form.listSearchEl.removeClass("hide"),$(document).on("click",form.hideSearchList))},hideSearchList:function(a){var b=$(a.target);(b.hasClass("search-item")||0==b.closest("#map-search-wrap").length)&&form.hideSearchList_()},hideSearchList_:function(){form.listSearchEl.addClass("hide"),form.listSearchUl.html(""),$(document).off("click",form.hideSearchList),form.mapSearchEl.val(form.mapSearchEl.data("val"))},preventEnterSubmit:function(a){13==a.keyCode&&a.preventDefault()}},form.fields=form.el.find("select:not(.exclude), input:not(.exclude)"),form.fields.on("change",getShowNumFrm),events.attachMobileEvent(form.el,"submit",form.filterFields),events.attachMobileEvent(form.fields.filter("#order_by"),"change",form.sortSubmit),form.listSearchUl=form.listSearchEl.find("ul"),form.mapSearchEl.on("focus",form.searchFocus).on("keyup",form.searchTyping).on("keydown",form.preventEnterSubmit),form.listSearchEl.on("click","a",form.searchItemClick).on("mouseenter","a",form.searchItemMouseEnter).on("mouseleave","a",form.searchItemMouseLeave),desktop={isLoadedResources:!1,countLoadedResource:0,checkToEnable:function(){desktop.isDesktop()&&!desktop.isEnabled?desktop.enable():!desktop.isDesktop()&&desktop.isEnabled&&desktop.disable()},isDesktop:function(){return"none"==$(".m-header").css("display")},enable:function(){desktop.isEnabled=!0,events.detachMobileEvents(),desktop.isLoadedResources||(desktop.isLoadedResources=!0,desktop.loadResources())},disable:function(){desktop.isEnabled=!1,events.detachDesktopEvents()},loadResources:function(){var a=document.getElementsByTagName("head")[0];for(var b in resources){var c=document.createElement("script");c.src=resources[b],a.appendChild(c)}},loadedResource:function(){desktop.countLoadedResource++,desktop.countLoadedResource==resources.length&&m2Map.initMap()}},desktop.checkToEnable(),$window.on("resize",desktop.checkToEnable);var a=form.fields.filter(function(){return!!this.value}).serialize(),b={location:form.mapSearchEl.val(),payload:a,tf:tf,referer:referer};tracking(b),toogleScroll(),getShowNumFrm(),$window.on("resize",toogleScroll),$(".advande-search").toggleShowMobi({btnEvent:".btn-submit",itemToggle:".toggle-search"}),$(".dropdown-common").dropdown({txtAdd:!0,styleShow:0}),$("#type").on("change",function(){$(".select-price .val-selected div span").hide(),$(".select-price .box-dropdown").price_dt({rebuild:!0}),1==$(this).val()?$(".select-price .box-dropdown").price_dt({hinhthuc:"mua"}):2==$(this).val()?$(".select-price .box-dropdown").price_dt({hinhthuc:"thue"}):$(".select-price .box-dropdown").price_dt()});var c=$("#type").val();1==c?$(".select-price .box-dropdown").price_dt({hinhthuc:"mua"}):2==c?$(".select-price .box-dropdown").price_dt({hinhthuc:"thue"}):$(".select-price .box-dropdown").price_dt(),$(".select-dt .box-dropdown").price_dt()});